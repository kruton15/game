<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>OGMO Layered Render</title>
<style>
  body {
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  /* ทำให้ canvas ขยายแบบรักษาอัตราส่วน */
  canvas {
    width: 100vw;
    height: 100vh;
    max-width: 640px;
    max-height: 480px;
    image-rendering: pixelated;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="320" height="240"></canvas>

<script>
// -----------------------------
// ข้อมูล Layer ทั้งหมด
// -----------------------------
const LAYER_BG1 = {
  gridCellWidth: 24, gridCellHeight: 24,
  data2D: [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [1,2,2,1,2,1,1,2,2,1,1,2,1,2],
    [3,3,3,3,3,3,3,3,3,3,3,3,3,3],
    [3,3,3,3,3,3,3,3,3,3,3,3,3,3],
    [3,3,3,3,3,3,3,3,3,3,3,3,3,3],
    [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
    [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]
  ]
};

const LAYER_FG = {
  gridCellWidth: 18, gridCellHeight: 18,
  data2D: [
    [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
    [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,14,-1,-1],
    [-1,-1,-1,19,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,19,-1,-1],
    [-1,4,9,14,-1,-1,-1,0,5,5,5,1,-1,-1,-1,-1,19,-1],
    [-1,-1,-1,-1,19,-1,0,11,11,11,11,11,1,-1,-1,-1,-1,-1],
    [-1,-1,-1,-1,-1,-1,10,11,11,11,11,11,2,-1,-1,-1,-1,-1],
    [-1,-1,-1,-1,-1,-1,7,11,11,11,11,11,15,-1,-1,-1,-1,-1],
    [-1,-1,-1,-1,-1,-1,-1,7,12,3,12,15,-1,-1,-1,-1,-1,-1],
    [-1,-1,-1,-1,-1,-1,-1,-1,-1,17,-1,-1,-1,-1,-1,-1,-1,-1],
    [-1,-1,-1,-1,-1,-1,-1,-1,8,13,23,-1,-1,-1,-1,-1,-1,-1],
    [-1,16,-1,-1,21,21,21,-1,-1,22,-1,-1,-1,20,21,-1,-1,-1],
    [6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],
    [18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18],
    [18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18]
  ]
};

// -----------------------------
// ฟังก์ชันวาด Tile Layer
// -----------------------------
function drawLayer(ctx, tileset, layer) {
  const { gridCellWidth: w, gridCellHeight: h, data2D } = layer;
  const tilesX = Math.floor(tileset.width / w);

  data2D.forEach((row, y) => {
    row.forEach((index, x) => {
      if (index < 0) return; // -1 = ช่องว่าง
      ctx.drawImage(
        tileset,
        (index % tilesX) * w,
        Math.floor(index / tilesX) * h,
        w, h,
        x * w,
        y * h,
        w, h
      );
    });
  });
}

// -----------------------------
// โหลดรูปแบบกระชับ (Promise)
// -----------------------------
function loadImage(src) {
  return new Promise(res => {
    const img = new Image();
    img.onload = () => res(img);
    img.src = src;
  });
}

// -----------------------------
// เริ่มต้นวาดทั้งหมด
// -----------------------------
(async () => {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  // โหลดทั้งสองรูปพร้อมกัน
  const [bg1, fg] = await Promise.all([
    loadImage("img/bg1.png"),
    loadImage("img/bg2.png")
  ]);

  // วาด BG และ FG
  drawLayer(ctx, bg1, LAYER_BG1);
  drawLayer(ctx, fg, LAYER_FG);
})();
</script>

</body>
</html>
